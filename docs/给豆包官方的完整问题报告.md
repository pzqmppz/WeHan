# Coze API 问题完整报告（用于发送给官方）

> **报告类型**：API 端点测试结果 + 官方解答验证 + 问题反馈
> **发送对象**：豆包/扣子技术支持团队
> **紧急程度**：🔴 高（阻塞项目核心功能开发）

---

## 第一部分：测试结果摘要

### 1.1 测试环境

| 配置项 | 值 |
|-------|-----|
| **测试时间** | 2026-02-28 10:15-10:20 |
| **测试方式** | Python requests + curl 穷举法 |
| **测试端点数** | 35+ |
| **Coze PAT** | pat_8A26QtZb1Gq06qXOwsS461ssE1q3WtAwnlLd47SEJt5iuSKLk9XQJMZyM8HwYDGQ |
| **SPACE_ID** | 7491691397280874533 |

### 1.2 测试结果

| 功能类别 | 可用 | 不可用 |
|---------|------|--------|
| **智能体 API** | 3 个 | 5 个 |
| **工作流 API** | 0 个 | 12+ 个 |
| **知识库 API** | 0 个 | 8+ 个 |

### 1.3 已验证可用的端点

```
✅ POST /v1/bot/create           -> 200 OK
✅ POST /v1/bot/update           -> 200 OK
✅ GET  /v1/bots?workspace_id=   -> 200 OK
```

### 1.4 官方文档描述但实际返回 404 的端点

| 功能 | 官方文档端点 | 实际测试结果 |
|-----|-------------|-------------|
| 创建智能体 | `POST /v1/bot` | ❌ 404 |
| 更新智能体 | `PATCH /v1/bot/{id}` | ❌ 404 |
| 创建工作流 | `POST /v1/workflow` | ❌ 404 |
| 创建知识库 | `POST /v1/knowledge_base` | ❌ 404 |

---

## 第二部分：官方解答 vs 实际验证

### 2.1 官方提供的解答（未验证）

以下内容来自官方文档或支持团队，但我们的实际测试返回 404：

#### 解答 1：工作流管理 API

| 功能 | 官方说的端点 | 我们测试结果 |
|-----|-------------|-------------|
| 创建工作流 | `POST /v1/workflow` | ❌ 404 |
| 更新工作流 | `PATCH /v1/workflow/{id}` | ❌ 404 |

**测试命令**：
```bash
curl -X POST "https://api.coze.cn/v1/workflow" \
  -H "Authorization: Bearer pat_YOUR_PAT" \
  -H "Content-Type: application/json" \
  -d '{"space_id": "YOUR_SPACE_ID", "name": "test", "nodes": [], "edges": []}'
# 结果：404 Not Found
```

#### 解答 2：知识库管理 API

| 功能 | 官方说的端点 | 我们测试结果 |
|-----|-------------|-------------|
| 创建知识库 | `POST /v1/knowledge_base` | ❌ 404 |
| 上传文档 | `POST /v1/knowledge_base/{id}/document` | ❌ 404 |

**测试命令**：
```bash
curl -X POST "https://api.coze.cn/v1/knowledge_base" \
  -H "Authorization: Bearer pat_YOUR_PAT" \
  -H "Content-Type: application/json" \
  -d '{"space_id": "YOUR_SPACE_ID", "name": "test", "type": "document"}'
# 结果：404 Not Found
```

#### 解答 3：智能体管理 API

| 功能 | 官方说的端点 | 实际测试结果 | 实际可用端点 |
|-----|-------------|-------------|-------------|
| 创建智能体 | `POST /v1/bot` | ❌ 404 | ✅ `POST /v1/bot/create` |
| 更新智能体 | `PATCH /v1/bot/{id}` | ❌ 404 | ✅ `POST /v1/bot/update` |

**实际可用端点测试**：
```bash
curl -X POST "https://api.coze.cn/v1/bot/create" \
  -H "Authorization: Bearer pat_YOUR_PAT" \
  -H "Content-Type: application/json" \
  -d '{"space_id": "YOUR_SPACE_ID", "name": "test", "prompt": {"system_prompt": "test"}}'
# 结果：200 OK, {"code":0,"msg":"success","data":{"bot_id":"xxx"}}
```

---

## 第三部分：核心问题

### 3.1 问题 1：官方解答与实际测试严重不符

官方文档中描述的 API 端点（`/v1/bot`, `/v1/workflow`, `/v1/knowledge_base`）在实际测试中全部返回 404。

**准确率统计**：
- 官方解答准确率：**0%**（0/3 个端点可用）
- 实际可用端点：官方文档均未提及

### 3.2 问题 2：工作流和知识库 API 完全不可用

- 工作流 API：测试了 12+ 种端点变体，全部 404
- 知识库 API：测试了 8+ 种端点变体，全部 404
- `GET /v1/workflows` 返回 500（端点存在但参数格式不明）

### 3.3 问题 3：参数命名不一致

- 获取智能体列表需要 `workspace_id` 参数（全小写）
- 官方文档使用 `space_id` 参数

---

## 第四部分：我们的应对方案

### 4.1 已采用方案：v3.0 纯 API 架构

由于官方 API 不可用，我们已调整为：

```
Bot → HTTP 节点 → B 端 API → B 端数据库
```

**优势**：
- ✅ 单一数据源
- ✅ 实时数据查询
- ✅ 无需维护知识库

**限制**：
- ⚠️ 工作流需在网页平台手动配置
- ⚠️ 无法完全自动化部署

### 4.2 已完成的工作

1. **智能体创建成功**
   - Bot ID: `7611738584064098310`
   - 使用实际可用的 `POST /v1/bot/create` 端点

2. **技术文档更新**
   - 创建 v3.1 技术框架（仅包含已验证信息）
   - 移除所有未验证的 API 端点

---

## 第五部分：需要官方解答的问题

### 问题 1：工作流 API 的正确用法是什么？

**背景**：
- 官方说 `POST /v1/workflow` 可用
- 我们测试返回 404
- 测试了 12+ 种端点变体，全部 404

**请解答**：
1. 创建工作流的正确 API 端点是什么？
2. 如果 API 未开放，预计什么时候开放？

### 问题 2：知识库 API 的正确用法是什么？

**背景**：
- 官方说 `POST /v1/knowledge_base` 可用
- 我们测试返回 404
- 测试了 8+ 种端点变体，全部 404

**请解答**：
1. 创建知识库的正确 API 端点是什么？
2. 如果 API 未开放，预计什么时候开放？

### 问题 3：是否有我们未发现的 API 版本或访问方式？

**请解答**：
1. 是否有 v2/v3 版本的 API？
2. 是否需要特殊的权限或白名单？
3. 是否有内测或灰度通道？

---

## 第六部分：测试附件

### 6.1 可复现的测试脚本

位置：`client/main/find_working_endpoints.py`

测试命令：
```bash
cd client
python main/find_working_endpoints.py
```

### 6.2 完整测试报告

文件：`docs/Coze-API测试报告-2026-02-28.md`

包含内容：
- 35+ 个端点的完整测试记录
- 请求/响应示例
- 错误码分析

### 6.3 问题详细记录

文件：`docs/Coze-API端点问题咨询.md`

包含内容：
- 官方解答原文
- 实际测试结果对比
- 参数命名问题

---

## 第七部分：联系信息

| 项目 | 信息 |
|-----|------|
| **项目名称** | WeHan 求职助手（武汉高校毕业生留汉服务平台） |
| **开发团队** | C 端 + B 端 |
| **紧急程度** | 🔴 高（阻塞开发进度） |
| **期望回复时间** | 24 小时内 |

---

**报告生成时间**: 2026-02-28
**报告版本**: v1.0
**测试执行者**: Claude Code AI
**测试数据**: 基于实际 API 调用结果
