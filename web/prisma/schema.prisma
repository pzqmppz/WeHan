generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Application {
  id          String            @id
  userId      String
  jobId       String
  resumeId    String?
  interviewId String?           @unique
  matchScore  Float?
  status      ApplicationStatus @default(PENDING)
  notes       String?
  createdAt   DateTime          @default(now())
  updatedAt   DateTime
  viewedAt    DateTime?
  Job         Job               @relation(fields: [jobId], references: [id], onDelete: Cascade)
  User        User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  Interview   Interview?

  @@unique([userId, jobId])
  @@index([createdAt])
  @@index([status])
}

model EmotionRecord {
  id        String   @id
  userId    String
  emotion   String
  score     Int
  content   String?
  tags      String[]
  createdAt DateTime @default(now())
  User      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([userId])
}

model Enterprise {
  id              String   @id
  name            String
  logo            String?
  industry        String
  scale           String
  description     String?
  address         String?
  contactName     String?
  contactPhone    String?
  contactEmail    String?
  businessLicense String?
  verified        Boolean  @default(false)
  createdAt       DateTime @default(now())
  updatedAt       DateTime
  Job             Job[]
  User            User[]

  @@index([industry])
  @@index([verified])
}

model Interview {
  id            String          @id
  userId        String
  jobId         String?
  applicationId String?         @unique
  outline       Json?
  conversation  Json?
  duration      Int?
  status        InterviewStatus @default(PREPARING)
  totalScore    Float?
  dimensions    Json?
  highlights    Json?
  improvements  Json?
  suggestions   String?
  audioUrl      String?
  createdAt     DateTime        @default(now())
  updatedAt     DateTime
  completedAt   DateTime?
  Application   Application?    @relation(fields: [applicationId], references: [id])
  User          User            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([status])
  @@index([userId])
}

model Job {
  id                 String          @id
  title              String
  enterpriseId       String
  industry           String?
  category           String?
  salaryMin          Int?
  salaryMax          Int?
  location           String?
  address            String?
  description        String
  requirements       String?
  benefits           String?
  skills             String[]
  educationLevel     String?
  experienceYears    Int?
  freshGraduate      Boolean         @default(true)
  headcount          Int             @default(1)
  status             JobStatus       @default(DRAFT)
  interviewQuestions String?
  createdAt          DateTime        @default(now())
  updatedAt          DateTime
  publishedAt        DateTime?
  Application        Application[]
  Enterprise         Enterprise      @relation(fields: [enterpriseId], references: [id], onDelete: Cascade)
  JobPushRecord      JobPushRecord[]

  @@index([enterpriseId])
  @@index([industry])
  @@index([location])
  @@index([status])
}

model JobPushRecord {
  id           String   @id
  jobId        String
  schoolId     String
  targetMajors String[]
  pushCount    Int      @default(0)
  createdAt    DateTime @default(now())
  Job          Job      @relation(fields: [jobId], references: [id], onDelete: Cascade)
  School       School   @relation(fields: [schoolId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([schoolId])
}

model Policy {
  id            String     @id
  title         String
  type          PolicyType
  content       String
  summary       String?
  conditions    String?
  benefits      String?
  effectiveDate DateTime?
  expiryDate    DateTime?
  isActive      Boolean    @default(true)
  createdAt     DateTime   @default(now())
  updatedAt     DateTime

  @@index([isActive])
  @@index([type])
}

model PortalConfig {
  id          String   @id
  key         String   @unique
  value       Json
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime
}

model Resume {
  id             String   @id
  userId         String   @unique
  originalUrl    String?
  name           String?
  phone          String?
  email          String?
  education      Json?
  experiences    Json?
  projects       Json?
  skills         String[]
  certifications Json?
  awards         Json?
  profile        Json?
  createdAt      DateTime @default(now())
  updatedAt      DateTime
  User           User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model School {
  id            String          @id
  name          String
  logo          String?
  type          String
  level         String
  address       String?
  contactName   String?
  contactPhone  String?
  verified      Boolean         @default(false)
  createdAt     DateTime        @default(now())
  updatedAt     DateTime
  JobPushRecord JobPushRecord[]
  User          User[]

  @@index([verified])
}

model Statistics {
  id        String   @id
  date      DateTime @db.Date
  type      String
  key       String
  value     Int
  createdAt DateTime @default(now())

  @@unique([date, type, key])
  @@index([date])
  @@index([type])
}

model User {
  id              String          @id
  email           String          @unique
  phone           String?         @unique
  password        String
  name            String
  avatar          String?
  role            UserRole
  status          UserStatus      @default(PENDING)
  schoolId        String?
  major           String?
  graduationYear  Int?
  enterpriseId    String?
  schoolManagedId String?
  createdAt       DateTime        @default(now())
  updatedAt       DateTime
  lastLoginAt     DateTime?
  Application     Application[]
  EmotionRecord   EmotionRecord[]
  Interview       Interview[]
  Resume          Resume?
  Enterprise      Enterprise?     @relation(fields: [enterpriseId], references: [id])
  School          School?         @relation(fields: [schoolManagedId], references: [id])

  @@index([role])
  @@index([status])
}

enum ApplicationStatus {
  PENDING
  VIEWED
  INTERVIEWING
  OFFERED
  REJECTED
  WITHDRAWN
}

enum InterviewStatus {
  PREPARING
  IN_PROGRESS
  COMPLETED
  EXPIRED
}

enum JobStatus {
  DRAFT
  PUBLISHED
  CLOSED
  ARCHIVED
}

enum PolicyType {
  SUBSIDY
  HOUSING
  TALENT
  ENTREPRENEUR
  OTHER
}

enum UserRole {
  STUDENT
  ENTERPRISE
  SCHOOL
  GOVERNMENT
  ADMIN
}

enum UserStatus {
  ACTIVE
  INACTIVE
  PENDING
  REJECTED
}
